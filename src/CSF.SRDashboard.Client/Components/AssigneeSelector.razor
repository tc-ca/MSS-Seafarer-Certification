
@using DTO.Azure
@using Client.Models


<EditForm EditContext="@EditContext">
    <div class="row">
        <div class="col-12 d-grid gap-3 mt-2">

            @if (!this.IsReadOnly)
            {
                <FormInputSelect Label="Assinee Select" @bind-Value="RequestModel.AssigneeId" ValidationFor="@(() => RequestModel.AssigneeId)">
                    @foreach (var member in mme_members)
                    {
                    <option value="@member.id"> @member.Names</option>
                    }
                </FormInputSelect>
            }
            else
            {
                <label class="form-label"><b>Assined To :</b></label>
                @if (previouslySelectedMME != null)
                {
                    <p>@previouslySelectedMME.Names</p>
                }
            }
        </div>
    </div>
</EditForm>



@code
{
    [Parameter]
    public EditContext EditContext
    {
        get => editContext; set
        {
            if (editContext == value) return;
            this.editContext = value;
        }
    }

    private EditContext editContext;
    private List<AzureMemberInfo> mme_members;

    [Parameter]
    public RequestModel RequestModel { get; set; }

    [Parameter]
    public bool IsReadOnly { get; set; }

    [Inject]
    protected IUserGraphApiService graphService { get; set; }

    private AzureMemberInfo previouslySelectedMME;

    protected override void OnInitialized()
    {
        mme_members = graphService.GetMmeGroupMembers();

        previouslySelectedMME = mme_members.Where(x => x.id == RequestModel.AssigneeId).FirstOrDefault();

        if (RequestModel.AssigneeId != null)
        {
            previouslySelectedMME = graphService.GetUserByUserId(RequestModel.AssigneeId);
        }
    }


    //private void OnValueChanged(ChangeEventArgs e)
    //{
    //    if (e.Value.ToString() != string.Empty)
    //    {
    //        RequestModel.AssigneeId = e.Value.ToString();
    //    }
    //    else
    //    {
    //        RequestModel.AssigneeId = null;
    //    }
    //}

}
